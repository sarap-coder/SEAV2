<?xml version="1.0" encoding="UTF-8"?>
<launch>

  <arg name="joint_name" default="leg_1_joint"/>
  <arg name="joint_name_suffix" default=""/>
  <arg name="controller_pkg_name" default="simple_models_controller_configuration"/>
  <!-- <arg name="local_control_type" default="direct_effort_control"/> -->
  <arg name="local_control_type" default=""/>
  <arg name="local_control_type_pkg" default=""/>
  <arg name="valgrind" default="false"/>
  <arg name="debug" default="false"/>
  <arg name="fixed_model" default="false"/>
  <arg name="simulator_config" default=""/>
  <arg name="gui" default="false"/>

  <rosparam command="delete" param="/simulator" />
  <rosparam command="delete" param="/sine_sweep_controller" />

  <include file="$(find simple_models_description)/robots/upload.launch" >
    <arg name="robot" value="pendulum"/>
  </include>
  <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"/>

  <!-- Load actuator parameters -->
  <rosparam command="load" ns="simulator" file="$(arg simulator_config)" />

  <group unless="$(eval arg('debug') or arg('valgrind'))">
  <!-- simulator -->
    <node name="joint_simulator_main"
        pkg="pal_local_joint_control" type="joint_simulator_main" output="screen"
        args="-n $(arg joint_name) -f $(arg fixed_model)" />
  </group>

  <group if="$(arg valgrind)">
  <!-- simulator -->
    <node name="joint_simulator_main"
        pkg="pal_local_joint_control" type="joint_simulator_main" output="screen"
        launch-prefix="valgrind"
        args="-n $(arg joint_name) -f $(arg fixed_model)" />
  </group>

  <group if="$(arg debug)">
  <!-- simulator -->
    <node name="joint_simulator_main"
        pkg="pal_local_joint_control" type="joint_simulator_main" output="screen"
        launch-prefix="gdb -ex run --args"
        args="-n $(arg joint_name) -f $(arg fixed_model)" />
  </group>

  <!-- chirp controller -->

  <include file="$(find local_sine_sweep_torque_controller)/launch/sine_sweep_controller.launch" >
    <arg name="local_joint_control" value="$(arg local_control_type)"/>
    <arg name="local_joint_control_pkg" value="$(arg local_control_type_pkg)"/>
    <arg name="joint_name" value="$(arg joint_name)"/>
    <arg name="joint_name_suffix" value="$(arg joint_name_suffix)"/>
    <arg name="controller_pkg_name" value="$(arg controller_pkg_name)"/>
  </include>

  <group if="$(arg gui)">
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find pal_local_joint_control)/config//rviz.rviz" />
  </group>

  <!-- introspection controller -->
  <include file="$(find introspection_controller)/introspection_controller.launch" />

</launch>
